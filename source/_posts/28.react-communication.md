title: React的组件间通讯方式
date: 2016-06-24
tags: [JavaScript,React]
---
对于`React`库的组件间通讯通常有两种方式：

0. 父子组件间通讯用refs和props属性进行传递。
1. 无关系的组件通讯用全局事件Pub/Sub发布订阅模式，在 componentDidMount() 里订阅事件，在 componentWillUnmount() 里取消订阅，当事件触发时调用 setState() 更新。
一般来说，对于比较复杂的应用，推荐使用单向数据流架构，Facebook官方的[Flux](http://facebook.github.io/flux/)或者第三方[Redux](https://github.com/reactjs/redux/)都是这种方式。

我今天重点说前者（注：示例使用ES6语法）。

## 子级访问父级
子级访问和修改父级的属性，使用props属性：

```
class Parent extends React.Component {
    constructor() {
        super();
        this.state = {
            name: 'hello'
        };
        this.update = this.update.bind(this);
    }
    update(val) {
        this.setState({name: val});
    }
    render() {
        return <Child name={this.state.name} update={this.update}/>;
    }
};

class Child extends React.Component {
    constructor() {
        super();
        this.modify = this.modify.bind(this);
    }
    modify() {
        this.props.update('world');
    }
    render() {
        return (
            <div>
                <p>Parent Name:{this.props.name}</p>
                <a href="javascript:;" onClick={this.modify}>Update it</a>
            </div>
        );
    }
};
```

## 父级访问子级
父级访问和修改子级的属性，使用refs属性：

```
class Parent extends React.Component {
    constructor() {
        super();
        this.update = this.update.bind(this);
    }
    update() {
        this.refs.children.setState({name: 'world'});
    }
    render() {
        return (
            <div>
                <Child ref="children"/>
                <a href="javascript:;" onClick={this.update}>Update it</a>
            </div>
        );
    }
};
class Child extends React.Component {
    constructor() {
        super();
        this.state = {
            name: 'hello'
        };
    }
    render() {
        return (
            <div>Child Name:{this.state.name}</div>
        );
    }
};
```
