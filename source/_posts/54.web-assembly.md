title: WebAssembly 从入门到入门
date: 2023-10-26
tags: [CSS]

---

## WebAssembly 定义

-   它是一种新的编码方式，可以在现代的浏览器中运行
-   它是一种低级的类汇编语言，具有紧凑的二进制格式，可以接近原生的性能运行，并为诸如 C/C++ 等语言提供一个编译目标，以便它们可以在 Web 上运行。
-   它被设计为可以与 JavaScript 共存，允许两者一起工作。

## WebAssembly 优势

-   高效：完整语义、二进制
-   安全：沙箱化执行
-   开放：文本格式，可读可调试
-   标准：无版本，向后兼容

## 常见概念

0. Module 一个“代码单元”。包含编译好的二进制代码。可以高效的缓存、共享。 可以像一个 ES2015 模块一样导入/导出。
1. Memory 连续的，大小可变的字节数组，即 ArrayBuffer。 可以理解为一个“堆”。
2. Table 连续的，大小可变的类型数组。存储了不能作为原始字节存储在内存里的对象的引用。 可以类比为一个“栈”。
3. Instance 一个模块及包含其所有运行时所需状态的实例。 如果把 Module 类比为一个 cpp 文件，那么 Instance 就是链接了 dll 的 exe 文件。

## 构建方法

0. 直接汇编文本编写

    WebAssembly 使用 S-表达式作为文本格式 劣势显而易见，编码逻辑不容易理解

1. 编译一个 C/C++ 程序

    构建过程中使用了 Emscripten——一个基于 llvm 的编译器，目的是把 c/c++编译为 asm.js（js 的一个真子集）

    我们知道，c 和 js 语法十分相似。所以在 c 到 js 的编译过程中，要解决的最重要的问题主要是两点： C/C++是静态类型，js 是动态类型 C/C++需要程序员手动管理内存，js 则有自己的一套垃圾回收机制
