title: React开发技巧总结
date: 2016-07-15
tags: [JavaScript,React]
---
最近使用`React`库开发项目，期间遇到很多很小的难点、疑点或者说“坑”，记录下来，以备查询。

## 使用file表单控件上传图片时，chrome不允许重复上传同一文件造成的bug

自己开发了一个uploader 组件，用于图片上传。
在chrome下，发现当对同一图片选择然后移除，再次上传时，没有反应（onchange事件不会执行）。
后来发现是chrome的一个[特性](http://stackoverflow.com/questions/9155136/chrome-file-upload-bug-on-change-event-wont-be-executed-twice-with-the-same-fi)造成的
知道原因解决方法就简单了，就是每次移除预览图时，重置file控件的value值：

```javascript
this.refs.inputfile.value = '';
```

## 使用react-router时，网址支持二级目录
假如一个项目的网址如 www.company.com/myproject。
而我们用react-router已经把项目根目录设置为 "/" ，不想每个路由规则或者链接都添加同样的 "myproject" 字样的话，我们可以使用 history 实例添加 basename 属性来解决这个问题。

### 整体路由设置：

```javascript
import {Router, Route, useRouterHistory} from 'react-router';
import {createHistory} from 'history';
const customHistory = useRouterHistory(createHistory)({basename: 'myproject'});

render((
<Router history={customHistory}>
    <Route path="/" component={App}>
        <Route path="about" component={About}>
            <Route path="join" component={Join}/>
            <Route path="contact" component={Contact}/>
        </Route>
        <Route path="*" component={NoMatch}/>
    </Route>
</Router>
), document.getElementById('root'));
```

### 页面跳转链接设置：
区分两种情况：
1. 使用Link组件的，直接设置正常路径，basename属性会自动添加
2. 使用脚本跳转，可以使用 withRouter 高阶组件

```javascript
import {Link, withRouter} from 'react-router';
class About extends React.Component {
    ...
    goto() {
        this.props.router.push({pathname: '/about', null, state: {}});
    }
    ...
    render() {
        return (
            <Link to="/about">About</Link>
        )
    }
}
export default withRouter(About);
```
