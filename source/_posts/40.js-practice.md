title: JavaScript 实践
date: 2018-10-12
tags: [JavaScript]
---

## 页面平滑滚动
优先使用原生方法：Firefox36+、Chrome61+ 支持，然后再用 requestAnimationFrame 兼容实现

```javascript
function scrollGo(evt, element, offset = 0) {
    evt && evt.preventDefault();
    if (typeof element == 'string') {
        element = document.getElementById(element);
    }
    var isSmooth = 'scrollBehavior' in document.documentElement.style;
    let position = element.getBoundingClientRect().top + window.pageYOffset - offset;
    if (isSmooth) {
        window.scrollTo({ 'behavior': 'smooth', 'top': position });
    } else {
        animateScroll(element, offset);
    }
}
function animateScroll(element, offset = 0, speed = 50) {
    const currentTop = element.getBoundingClientRect().top;
    let currentPageY = window.pageYOffset;
    let requestId;

    function scroll(timestamp) {
        let distance = element.getBoundingClientRect().top - offset;
        let step = Math.min(speed, Math.abs(distance));
        let condition;
        if (currentTop > 0) {
            currentPageY += step;
            condition = distance > 0;
        } else {
            currentPageY -= step;
            condition = distance < 0;
        }
        if (condition) {
            window.scrollTo(0, currentPageY);
            requestId = window.requestAnimationFrame(scroll);
        } else {
            window.cancelAnimationFrame(requestId);
        }
    }
    window.requestAnimationFrame(scroll);
}
// 用法 <a href onclick="scrollGo(event, 'targetID', 15)">
```

## 判断 Safari 浏览器

```javascript
isSafari = !window.chrome && 'WebkitAppearance' in document.documentElement.style;
```

## 记录当前焦点所在的元素。

> 因为当打开开发者工具的时候会将 activeElement 的焦点移除。

```javascript
$('body').on('focusin',function(){console.log(document.activeElement);});
```
